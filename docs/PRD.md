# 제품 요구사항 문서 (PRD): Poker-Mate

## 1. 프로젝트 개요
**제품명:** Poker-Mate
**비전:** "단순한 챗봇이 아닌, 실시간 게임 상황을 이해하는 포커 파트너"
**설명:** Poker-Mate는 홀덤 플레이어를 위한 실시간 전략 코칭 및 컴패니언 AI 백엔드 서비스입니다. 일반적인 LLM을 넘어, 도메인 특화 로직, 실시간 스트리밍, 동적 페르소나를 통합하여 즉각적인 전략 조언이나 정서적 지지를 제공합니다.

### 주요 가치 제안 (Key Value Propositions)
*   **도메인 특화:** 홀덤 포커 룰을 인지하고 이에 최적화된 설계.
*   **실시간 상호작용:** SSE 및 캐싱을 활용한 저지연 응답.
*   **적응형 성격:** "냉철한 전략가"와 "따뜻한 위로자" 모드 간 전환 가능.

## 2. 사용자 스토리
*   **플레이어로서,** 더 나은 전략적 결정을 내리기 위해 내 핸드에 대한 실시간 조언을 받고 싶다.
*   **플레이어로서,** "배드 빗(Bad Beat)"을 당했을 때 침착함을 유지(틸트 제어)할 수 있도록 AI의 위로를 받고 싶다.
*   **플레이어로서,** 할루시네이션 없는 정확한 룰 설명을 게임 중에 듣고 싶다.
*   **사용자로서,** 매번 내 스타일을 설명하지 않아도 AI가 세션을 넘어서 내 플레이 스타일을 기억해주길 원한다.

## 3. 기능적 요구사항

### 3.1. 실시간 AI 채팅 (Core)
*   **스트리밍 응답:** 시스템은 SSE(Server-Sent Events)를 지원하여 AI 응답을 토큰 단위로 스트리밍해야 한다.
*   **지연 시간 목표:** 자주 묻는 질문(FAQ)은 캐시를 통해 5ms 이내에 응답해야 한다.

### 3.2. 맥락 관리 (Memory)
*   **단기 기억 (Short-term):** 즉각적인 대화 맥락 유지를 위해 최근 10턴의 대화를 Redis에 캐싱해야 한다.
*   **장기 기억 (Long-term):** 각 세션 종료 시, 사용자 플레이 스타일 태그를 요약하여 MySQL에 영구 저장해야 한다.

### 3.3. 동적 페르소나 시스템
*   사용자 설정이나 게임 상황에 따라 다른 시스템 프롬프트(페르소나)를 로드할 수 있어야 한다.
*   지원 페르소나:
    *   **전략가 (Strategist):** 수학, 확률, GTO(게임 이론 최적화) 플레이에 초점.
    *   **동반자 (Companion):** 정서적 지지와 멘탈 코칭에 초점.

### 3.4. 할루시네이션 제어
*   **룰 주입:** 룰 관련 질문 시, 사전에 정의된 JSON "포커 확률표"를 프롬프트 컨텍스트에 주입하여 정확성을 보장해야 한다.

## 4. 비기능적 요구사항

### 4.1. 성능
*   **응답 시간:** 캐시되지 않은 LLM 응답은 첫 번째 토큰이 생성되는 즉시 스트리밍을 시작해야 한다.
*   **동시성:** 비차단(Non-blocking) 비동기 처리를 통해 다수의 동시 게임 세션을 처리해야 한다.

### 4.2. 신뢰성
*   **데이터 무결성:** 사용자 통계 및 장기 기억은 ACID를 준수하는 관계형 데이터베이스(MySQL)에 저장되어야 한다.

### 4.3. 확장성
*   아키텍처는 수평 확장(공유 Redis를 사용하는 Stateless API)을 지원해야 한다.

## 5. 기술 사양

### 5.1. 기술 스택
| 컴포넌트 | 기술 | 선정 이유 |
| :--- | :--- | :--- |
| **언어** | Java 17 | 안정성 및 최신 기능(Records, Text Blocks) 활용. |
| **프레임워크** | Spring Boot 3.2 | 빠른 개발 속도 및 방대한 생태계. |
| **데이터베이스** | MySQL 8.0 | 구조화된 데이터 저장(사용자, 통계). |
| **캐시** | Redis | 고속 I/O를 통한 컨텍스트 및 세션 관리. |
| **AI 통합** | Spring AI / OpenAI API | LLM 인터페이스. |
| **프로토콜** | SSE (Server-Sent Events) | 실시간 텍스트 스트리밍. |

### 5.2. 데이터 모델 (ERD)
*   **Users**: 계정 정보 저장.
*   **Personas**: 프롬프트 템플릿 및 성격 설정 저장.
*   **Chat_Sessions**: 각 게임/채팅 세션의 메타데이터.
*   **Chat_Logs**: 대화 내역 원본.
*   **Game_Stats**: 집계된 지표(승률, VPIP 등).

### 5.3. API 구조
*   `POST /api/chat/stream`: 채팅 요청을 시작하고 SSE 스트림을 반환.
*   `GET /api/personas`: 사용 가능한 AI 페르소나 조회.
*   `GET /api/history`: 과거 세션 요약 조회.
